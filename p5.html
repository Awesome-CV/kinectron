<html>
	<head>
		<script language="javascript" type="text/javascript" src="p5.min.js"></script>
		<script src="peer.min.js"></script>
		<script type="text/javascript">

			var mypeerid = null;
		  var peer = null;
		  var connection = null;

			peer = new Peer({host: 'liveweb.itp.io', port: 9001, path: '/'})
			//peer = new Peer({key: 'uohu08l7r6swcdi'});
			peer.on('open', function(id) {
				console.log('My peer ID is: ' + id);
				mypeerid = id;
			});

			peer.on('connection', function(conn) {
				connection = conn;
				connection.on('open', function() {
          console.log("connected");
				});
				connection.on('data', function(data) {
					console.log(data);
				});
			});

      function makeConnection() {
        var peerid = document.getElementById('peerid').value;
        connection = peer.connect(peerid); // get a webrtc DataConnection
  			connection.on('open', function(data) {
  				console.log("Open data connection with server");

  			});

  			connection.on('data', function(dataReceived) {
          //console.log(dataReceived);
					if (dataReceived.event == 'bodyFrame') {
						//console.log("Body Frame:");
						//console.log(dataReceived.data);

						for (var i = 0; i < dataReceived.data.bodies.length; i++) {
							if (dataReceived.data.bodies[i].tracked == true) {
								console.log(dataReceived.data.bodies[i].joints);
								for (var j = 0; j < dataReceived.data.bodies[i].joints.length; j++) {
									joints[j] = {x: (dataReceived.data.bodies[i].joints[j].cameraX)*characterWidth/2+width/2,
									 				y: (dataReceived.data.bodies[i].joints[j].cameraY*-1)*characterHeight/2+height/2+50};

									console.log(""+characterWidth/2+" "+width/2+" "+characterHeight/2+" "+height/2);

								}
								console.log(joints);
							}
						}
								// joints[data.position] = {x: (data.x)*characterWidth/2+width/2,
								// 				y: (data.y*-1)*characterHeight/2+height/2+50};


					}
        });
      }


			var STROKESIZE = 5;
			var ERASESTROKESIZE = 20;

			var currentStrokeSize = STROKESIZE;

			var currentJointIntersection = null;

			var characterWidth = 250;
			var characterHeight = 400;

			var backgroundColor = 0;
			var characterColor = 200;

			var joints = [];
			for (var a = 0; a < 23; a++) {
				joints[a] = 0;
			}

			var center = {x: 0, y: 0};

			function setup() {
				debug(windowWidth + " " + windowHeight);

				var can = createCanvas(windowWidth, windowHeight-100);
				can.parent("canvas_div");

				center.x = characterWidth/2+width/2;
				center.y = characterHeight/2+height/2+50;
			}

			function draw() {
				background(backgroundColor);

				fill(backgroundColor);
				stroke(characterColor);
				strokeWeight(STROKESIZE);
				ellipseMode(CENTER);

				if (joints[2] != null) {
					if (joints[3] != null) {
						line(joints[2].x, joints[2].y, joints[3].x, joints[3].y);

						ellipse(
							(joints[2].x + joints[3].x)/2,
							(joints[2].y + joints[3].y)/2 - (joints[2].y - joints[3].y)*2,
							(joints[2].y - joints[3].y)*4,
							(joints[2].y - joints[3].y)*4
						);
					}

					if (joints[20] != null) {
						line(joints[2].x, joints[2].y, joints[20].x, joints[20].y);

						if (joints[1] != null) {

							line(joints[20].x, joints[20].y, joints[1].x, joints[1].y);
							if (joints[17] != null) {
								line(joints[1].x, joints[1].y, joints[17].x, joints[17].y);
								if (joints[19] != null) {
									line(joints[17].x, joints[17].y, joints[19].x, joints[19].y);
								}
							}

							if (joints[13] != null) {

								line(joints[1].x, joints[1].y, joints[13].x, joints[13].y);
								if (joints[15] != null) {
									line(joints[13].x, joints[13].y, joints[15].x, joints[15].y);
								}
							}
						}

						if (joints[8] != null) {
							line(joints[20].x, joints[20].y, joints[8].x, joints[8].y);
							if (joints[9] != null) {
								line(joints[8].x, joints[8].y, joints[9].x, joints[9].y);
								if (joints[10] != null) {
									line(joints[9].x, joints[9].y, joints[10].x, joints[10].y);
									if (joints[23] != null) {
										line(joints[10].x, joints[10].y, joints[23].x, joints[23].y);
									}
								}
							}
						}

						if (joints[4] != null) {
							line(joints[20].x, joints[20].y, joints[4].x, joints[4].y);
							if (joints[5] != null) {
								line(joints[4].x, joints[4].y, joints[5].x, joints[5].y);
								if (joints[6] != null) {
									line(joints[5].x, joints[5].y, joints[6].x, joints[6].y);

									if (joints[21] != null) {
										line(joints[6].x, joints[6].y, joints[21].x, joints[21].y);
									}
								}
							}
						}
					}
				}
			}

			function debug(message) {
				console.log(message);
			}

		</script>
	</head>
	<body>
    <input type="text" id="peerid" value="Peer Id To Connect To">
    <input type="button" value="Connect" onclick="makeConnection();">

	<div id="canvas_div">
	</div>
	</body>
</html>
